<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ilha Bela Hub | Vendas & Suporte</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .chat-window { height: 400px; overflow-y: auto; scroll-behavior: smooth; }
        .hidden { display: none; }
        body { background: #020617; color: white; }
        .admin-sidebar { border-right: 1px solid #1e293b; }
    </style>
</head>
<body>

    <nav class="bg-black border-b border-yellow-600 p-4 flex justify-between items-center sticky top-0 z-50">
        <h1 class="text-xl font-black text-yellow-500 tracking-tighter">ILHA BELA HUB</h1>
        <div class="flex gap-4">
            <button onclick="showSection('loja')" class="text-sm font-bold">LOJA</button>
            <button id="btn-adm-login" onclick="solicitarAcessoAdm()" class="text-sm text-gray-500 bg-gray-900 px-3 py-1 rounded">PAINEL ADM</button>
        </div>
    </nav>

    <section id="secao-loja" class="container mx-auto p-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="grid-produtos">
            </div>
    </section>

    <div id="chat-container" class="fixed bottom-4 right-4 w-80 bg-slate-900 border border-yellow-600 rounded-t-2xl shadow-2xl hidden">
        <div class="bg-yellow-600 p-3 text-black font-bold flex justify-between rounded-t-xl">
            <span>Suporte Online</span>
            <button onclick="fecharChat()">X</button>
        </div>
        <div id="chat-mensagens" class="chat-window p-4 text-sm flex flex-col gap-2"></div>
        <div class="p-3 border-t border-slate-800 flex gap-2">
            <input type="text" id="input-msg" placeholder="Sua mensagem..." class="flex-1 bg-black p-2 rounded text-xs outline-none">
            <button onclick="enviarMensagem()" class="bg-yellow-600 px-3 py-1 text-black font-bold rounded">></button>
        </div>
    </div>

    <section id="secao-admin" class="container mx-auto p-6 hidden">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <div class="lg:col-span-1 space-y-2 admin-sidebar pr-4">
                <button onclick="showAdminTab('produtos')" class="w-full text-left p-3 hover:bg-slate-800 rounded">üì¶ Produtos</button>
                <button onclick="showAdminTab('chats')" class="w-full text-left p-3 hover:bg-slate-800 rounded">üí¨ Atender Clientes</button>
                <button onclick="showAdminTab('vendedores')" class="w-full text-left p-3 hover:bg-slate-800 rounded">üë• Vendedores</button>
                <button onclick="showAdminTab('logs')" class="w-full text-left p-3 hover:bg-slate-800 rounded">üìú Logs do Sistema</button>
                <button onclick="showAdminTab('config')" class="w-full text-left p-3 hover:bg-slate-800 rounded">‚öôÔ∏è Configura√ß√µes</button>
            </div>

            <div class="lg:col-span-3 bg-slate-900 p-6 rounded-xl border border-slate-800">
                
                <div id="tab-produtos" class="admin-tab">
                    <h2 class="text-xl font-bold mb-4">Gerenciar Produtos</h2>
                    <div class="flex gap-2 mb-6">
                        <input type="text" id="new-prod-name" placeholder="Nome" class="bg-black p-2 rounded flex-1">
                        <input type="number" id="new-prod-price" placeholder="Valor" class="bg-black p-2 rounded w-24">
                        <button onclick="addProdutoBD()" class="bg-green-600 px-4 py-2 rounded font-bold">Add</button>
                    </div>
                    <div id="admin-lista-produtos" class="space-y-2"></div>
                </div>

                <div id="tab-chats" class="admin-tab hidden">
                    <h2 class="text-xl font-bold mb-4">Chats Ativos</h2>
                    <div id="admin-lista-chats" class="grid grid-cols-1 gap-2"></div>
                </div>

                <div id="tab-logs" class="admin-tab hidden">
                    <h2 class="text-xl font-bold mb-4">Logs Gerais</h2>
                    <div id="lista-logs" class="text-[10px] font-mono text-gray-400 space-y-1"></div>
                </div>
            </div>
        </div>
    </section>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIGURA√á√ÉO DO FIREBASE (Coloque seus dados aqui)
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "SEU_PROJETO.firebaseapp.com",
            projectId: "SEU_PROJETO_ID",
            storageBucket: "SEU_PROJETO.appspot.com",
            messagingSenderId: "ID",
            appId: "APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // CONFIGURA√á√ïES GLOBAIS
        const EMAIL_MASTER = "srleal018@gmail.com";
        let MEU_PIX = "52385277808";
        let chatIdAtual = localStorage.getItem('chat_session') || "user_" + Date.now();
        localStorage.setItem('chat_session', chatIdAtual);

        // --- SISTEMA DE LOGS ---
        async function registrarLog(acao, usuario) {
            await addDoc(collection(db, "logs"), {
                timestamp: new Date().toLocaleString(),
                acao: acao,
                usuario: usuario
            });
        }

        // --- GERENCIAMENTO DE PRODUTOS ---
        window.addProdutoBD = async () => {
            const nome = document.getElementById('new-prod-name').value;
            const valor = document.getElementById('new-prod-price').value;
            await addDoc(collection(db, "produtos"), { nome, valor, ativo: true });
            registrarLog(`Adicionou produto: ${nome}`, EMAIL_MASTER);
        };

        function carregarProdutos() {
            onSnapshot(collection(db, "produtos"), (snap) => {
                const grid = document.getElementById('grid-produtos');
                const adminGrid = document.getElementById('admin-lista-produtos');
                grid.innerHTML = ""; adminGrid.innerHTML = "";

                snap.forEach(doc => {
                    const p = doc.data();
                    // Card Loja
                    grid.innerHTML += `
                        <div class="bg-slate-900 border border-slate-800 p-6 rounded-2xl">
                            <h3 class="text-xl font-bold">${p.nome}</h3>
                            <p class="text-yellow-500 font-black text-2xl mb-4 text-mono">R$ ${p.valor}</p>
                            <button onclick="abrirChat('${p.nome}')" class="w-full bg-yellow-600 text-black py-2 rounded-lg font-bold">NEGOCIAR AGORA</button>
                        </div>`;
                });
            });
        }

        // --- SISTEMA DE CHAT EM TEMPO REAL ---
        window.abrirChat = (produto) => {
            document.getElementById('chat-container').classList.remove('hidden');
            enviarMensagemSistema(`Ol√°! Gostaria de comprar: ${produto}. Como fa√ßo para pagar via PIX?`);
        };

        async function enviarMensagemSistema(texto) {
            await addDoc(collection(db, "chats", chatIdAtual, "mensagens"), {
                texto: texto,
                sender: "cliente",
                time: new Date()
            });
            registrarLog("Cliente iniciou negocia√ß√£o", chatIdAtual);
        }

        window.enviarMensagem = async () => {
            const msg = document.getElementById('input-msg').value;
            if(!msg) return;
            await addDoc(collection(db, "chats", chatIdAtual, "mensagens"), {
                texto: msg,
                sender: "cliente",
                time: new Date()
            });
            document.getElementById('input-msg').value = "";
        };

        function ouvirMensagens() {
            const q = query(collection(db, "chats", chatIdAtual, "mensagens"), orderBy("time", "asc"));
            onSnapshot(q, (snap) => {
                const box = document.getElementById('chat-mensagens');
                box.innerHTML = "";
                snap.forEach(doc => {
                    const m = doc.data();
                    const align = m.sender === "cliente" ? "text-right" : "text-left";
                    const color = m.sender === "cliente" ? "bg-yellow-600 text-black" : "bg-slate-800";
                    box.innerHTML += `<div class="${align}"><span class="${color} p-2 rounded-lg inline-block">${m.texto}</span></div>`;
                });
                box.scrollTop = box.scrollHeight;
            });
        }

        // --- √ÅREA ADMINISTRATIVA ---
        window.solicitarAcessoAdm = () => {
            const email = prompt("Email de Acesso:");
            if(email === EMAIL_MASTER) {
                document.getElementById('secao-loja').classList.add('hidden');
                document.getElementById('secao-admin').classList.remove('hidden');
                registrarLog("Login realizado no painel", email);
                carregarLogs();
            } else {
                alert("Acesso Negado.");
            }
        };

        window.showAdminTab = (tab) => {
            document.querySelectorAll('.admin-tab').forEach(el => el.classList.add('hidden'));
            document.getElementById('tab-' + tab).classList.remove('hidden');
        };

        function carregarLogs() {
            onSnapshot(query(collection(db, "logs"), orderBy("timestamp", "desc")), (snap) => {
                const lista = document.getElementById('lista-logs');
                lista.innerHTML = "";
                snap.forEach(doc => {
                    const l = doc.data();
                    lista.innerHTML += `<div>[${l.timestamp}] - ${l.usuario}: ${l.acao}</div>`;
                });
            });
        }

        // INICIALIZA√á√ÉO
        carregarProdutos();
        ouvirMensagens();
        window.fecharChat = () => document.getElementById('chat-container').classList.add('hidden');
        window.showSection = (sec) => {
            document.getElementById('secao-loja').classList.remove('hidden');
            document.getElementById('secao-admin').classList.add('hidden');
        }
    </script>
</body>
</html>
